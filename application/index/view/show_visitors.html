<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VPN180监控中心-游客展示界面</title>
    <link rel="stylesheet" href="../../Public/layui/css/layui.css">
    <script src="../../Public/Js/jquery_v3.4.1.js"></script>
    <script src="../../Public/Js/jquery.cookie.js"></script>
    <script src="../../Public/layui/layui.all.js"></script>
    <script src="../../Public/layui/lay/modules/jquery.js"></script>
    <script src="../../Public/Js/highcharts.js"></script>
    <script src="../../Public/Js/exporting.js"></script>
    <script src="../../Public/Js/oldie.js"></script>
    <script src="../../Public/Js/highcharts-zh_CN.js"></script>
</head>
<style>
    .my-p{
        text-align: center;
        font-size: 16px;
        color: dodgerblue;
        margin:0 auto;
    }
</style>
<body>
<div class="layui-container">
    <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
        <ul class="layui-tab-title">
            <li class="layui-this" id="logLi"><p class="my-p" id="nameP"></p></li>
        </ul>
        <div class="layui-tab-content" style="height: 300px;width: 1125px">
            <!--网关 内容 -->
            <div class="layui-tab-item layui-show" style="width: 100%;height: 100%;">
               <div style="width: 15%;height: 100%;float: left;padding-right: 3%;padding-top: 1%">
                   <div style="padding: 3% 3% 1% 3%; background-color: #F2F2F2;width: 95%;height: 97%;">
                       <div style="height: 33%;width: 100%;padding-top: 1%">
                           <div class="layui-card">
                               <div class="layui-card-header">IP地址:</div>
                               <div class="layui-card-body">
                                   <p class="my-p">000.000.000.000</p>
                               </div>
                           </div>
                       </div>

                       <div style="height: 33%;width: 100%;padding-top: 1%;padding-bottom: 1%">
                           <div class="layui-card">
                               <div class="layui-card-header">eth0内网IP地址：</div>
                               <div class="layui-card-body">
                                   <p class="my-p">000.000.000.000</p>
                               </div>
                           </div>
                       </div>

                       <div style="height: 33%;width: 100%;">
                           <div class="layui-card">
                               <div class="layui-card-header">eth1内网IP地址：</div>
                               <div class="layui-card-body">
                                   <p class="my-p">000.000.000.000</p>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
                <div style="width: 48%;height:50%;float: left;">
                    <table class="layui-table" lay-skin="row">
                        <colgroup>
                            <col width="80">
                            <col width="100">
                            <col width="100">
                            <col width="100">
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th>通道编号</th>
                            <th>挂载设备</th>
                            <th>运行状态</th>
                            <th>详细参数</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>C1</td>
                            <td>未知设备</td>
                            <td><p style="float: left;padding-right: 3%">正常</p><span class="layui-badge-dot layui-bg-blue" style="float: left"></span></td>
                            <td style="color: dodgerblue" id="no1">详情点击</td>
                        </tr>
                        <tr>
                            <td>C2</td>
                            <td>未知设备</td>
                            <td><p style="float: left;padding-right: 3%">正常</p><span class="layui-badge-dot layui-bg-blue" style="float: left"></span></td>
                            <td style="color: dodgerblue" id="no2">详情点击</td>
                        </tr>
                        <tr>
                            <td>C3</td>
                            <td>未知设备</td>
                            <td><p style="float: left;padding-right: 3%">正常</p><span class="layui-badge-dot layui-bg-blue" style="float: left"></span></td>
                            <td style="color: dodgerblue" id="no3">详情点击</td>
                        </tr>
                        <tr>
                            <td>C4</td>
                            <td>未知设备</td>
                            <td><p style="float: left;padding-right: 3%">正常</p><span class="layui-badge-dot layui-bg-blue" style="float: left"></span></td>
                            <td style="color: dodgerblue" id="no4">详情点击</td>
                        </tr>
                        <tr>
                            <td>C5</td>
                            <td>未知设备</td>
                            <td><p style="float: left;padding-right: 3%">正常</p><span class="layui-badge-dot layui-bg-blue" style="float: left"></span></td>
                            <td style="color: dodgerblue" id="no5">详情点击</td>
                        </tr>
                        <tr>
                            <td>C6</td>
                            <td>null</td>
                            <td><p style="float: left;padding-right: 3%">未运行</p><span class="layui-badge-dot layui-bg-black" style="float: left"></span></td>
                            <td id="no6">详情点击</td>
                        </tr>
                        <tr>
                            <td>C7</td>
                            <td>null</td>
                            <td><p style="float: left;padding-right: 3%">未运行</p><span class="layui-badge-dot layui-bg-black" style="float: left"></span></td>
                            <td id="no7">详情点击</td>
                        </tr>
                        <tr>
                            <td>C8</td>
                            <td>null</td>
                            <td><p style="float: left;padding-right: 3%">未运行</p><span class="layui-badge-dot layui-bg-black" style="float: left"></span></td>
                            <td id="no8">详情点击</td>
                        </tr>
                        </tbody>
                    </table>
                    <div style="width: 100%;height: 100%">
                        <div style="width: 50%;height: 80px;float: left">
                            <div id="container" style="max-width:100%;height:200%;"></div>
                        </div>
                        <div style="width: 50%;height: 80px;float: left">
                            <div id="container1" style="max-width:100%;height:200%;"></div>
                        </div>
                    </div>
                </div>
                <div style="width: 30%;height: 100%;float: left;padding-left: 2%">
                    <div style="width: 100%;padding-bottom: 1%">
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 1%;margin-bottom: 0">
                            <legend><p style="color: #0C0C0C;font-size: 15px">电源实时温度</p></legend>
                        </fieldset>
                        <h1 style="padding-left: 45%;color: dodgerblue"> 50℃</h1></span>
                    </div>

                    <div style="width: 100%;padding-top: 1%">
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 1%;margin-bottom: 0">
                            <legend><p style="color: #0C0C0C;font-size: 15px">输出到收发信机的</p></legend>
                        </fieldset>
                        <table class="layui-table" lay-skin="line">
                            <colgroup>
                                <col width="150">
                                <col width="150">
                                <col width="150">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>实时电压</th>
                                <th>实时电流</th>
                                <th>状态</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>00.0</td>
                                <td>00.0</td>
                                <td>
                                    <h6 style="float: left;padding: 3px">正常 </h6><span class="layui-badge-dot layui-bg-blue" style="float: left"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="width: 100%;padding-top: 1%">
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 1%;margin-bottom: 0">
                            <legend><p style="color: #0C0C0C;font-size: 15px">输出到总线的</p></legend>
                        </fieldset>
                        <table class="layui-table" lay-skin="line">
                            <colgroup>
                                <col width="150">
                                <col width="150">
                                <col width="150">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>实时电压</th>
                                <th>实时电流</th>
                                <th>状态</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>00.0</td>
                                <td>00.0</td>
                                <td>
                                    <h6 style="float: left;padding: 3px">正常 </h6><span class="layui-badge-dot layui-bg-blue" style="float: left"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="width: 100%;padding-top: 1%">
                        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 1%;margin-bottom: 0">
                            <legend><p style="color: #0C0C0C;font-size: 15px">输出到ATOM的</p></legend>
                        </fieldset>
                        <table class="layui-table" lay-skin="line">
                            <colgroup>
                                <col width="150">
                                <col width="150">
                                <col width="150">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>实时电压</th>
                                <th>实时电流</th>
                                <th>状态</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>00.0</td>
                                <td>00.0</td>
                                <td>
                                    <h6 style="float: left;padding: 3px">正常 </h6><span class="layui-badge-dot layui-bg-blue" style="float: left"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var channel;
    //获取页面传过来的id
    var id = window.location.search.substring(4);
    $("#nameP").prepend("网关"+id);

    var ws = null;
    //创建websocket连接
    ws = new WebSocket("ws://127.0.0.1:9090");
    ws.onopen = function (){
        var str = '{ "id": '+id+', "request": "getShowVisitors" }';
        ws.send(str);
        console.log("WebSocket 成功连接");
    }

    ws.onmessage = function (data) {
        console.log(data.data);
    };

    ws.onclose = function () {
        console.log("websocket 断开连接")
    };


    $('#bt_send').click(function () {

    });
    $('#bt_left').click(function () {
        if (ws!=null){
            ws.close();
        }
    });

    // 监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口。
    window.onbeforeunload = function() {
        ws.close();
    }

    /**
     * 初始化数据...
     */
    $("#no1").click(function () {
        channel=1;
        detail();
    });
    $("#no2").click(function () {
        channel=2;
        detail();
    });
    $("#no3").click(function () {
        channel=3;
        detail();
    });
    $("#no4").click(function () {
        channel=4;
        detail();
    });
    $("#no5").click(function () {
        channel=5;
        detail();
    });
    $("#no6").click(function () {
        channel=6;
    });
    $("#no7").click(function () {
        channel=7;
    });
    $("#no8").click(function () {
        channel=8;
    });

    function detail() {
        layer.open({
            type: 2 //弹框类型
            ,title: 'NO.'+channel+'通道信息'
            ,area: ['100%', '100%']
            ,shade: 0
            ,maxmin: true
            ,content: 'channel.html?id='+id+"&channel="+channel
            ,btn: [ '阅览完毕']
            ,btn1: function(){
                layer.closeAll();
            }
            ,zIndex: layer.zIndex
            ,success: function(layero){
                layer.setTop(layero);
            }
        });
    }

    Highcharts.setOptions({
        global: {
            useUTC: false
        }
    });
    function activeLastPointToolip(chart) {
        var points = chart.series[0].points;
        chart.tooltip.refresh(points[points.length -1]);
    }

    var chart = Highcharts.chart('container', {
        chart: {
            type: 'spline',
            marginRight: 10,
            events: {
                load: function () {
                    var series = this.series[0],
                        chart = this;
                    activeLastPointToolip(chart);
                    setInterval(function () {
                        var x = (new Date()).getTime(), // 当前时间
                            y = Math.floor(Math.random()*1000);          // 随机值
                        series.addPoint([x, y], true, true);
                        activeLastPointToolip(chart);
                    }, 1000);
                }
            }
        },
        title: {
            text: '平均网络延迟',
            style: {
                color: '#1f1f1f',
                "fontSize": "16px",
            }
        },
        xAxis: {
            type: 'datetime',
            tickPixelInterval: 150
        },
        yAxis: {
            title: {
                text: null
            }
        },
        tooltip: {
            formatter: function () {
                return Highcharts.dateFormat('%H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2)+'ms';
            }
        },
        legend: {
            enabled: false
        },
        credits: {
            enabled: false
        },
        series: [{
            name: '平均延时',
            marker: {
                //小圆点
                enabled: false
            },
            data: (function () {
                // 生成随机值
                var data = [],
                    time = (new Date()).getTime(),
                    i;
                for (i = -19; i <= 0; i += 1) {
                    data.push({
                        x: time + i * 1000,
                        y: Math.floor(Math.random()*1000),
                    });
                }
                return data;
            }())
        }]
    });
    var chart1 = Highcharts.chart('container1', {
        chart: {
            type: 'spline',
            marginRight: 10,
            events: {
                load: function () {
                    var series = this.series[0],
                        chart = this;
                    activeLastPointToolip(chart);
                    setInterval(function () {
                        var x = (new Date()).getTime(), // 当前时间
                            y = Math.floor(Math.random()*1000);          // 随机值
                        series.addPoint([x, y], true, true);
                        activeLastPointToolip(chart);
                    }, 1000);
                }
            }
        },
        title: {
            text: '实时网络延迟',
            style: {
                color: '#1f1f1f',
                "fontSize": "16px",
            }
        },
        xAxis: {
            type: 'datetime',
            tickPixelInterval: 150
        },
        yAxis: {
            title: {
                text: null
            }
        },
        tooltip: {
            formatter: function () {
                return Highcharts.dateFormat('%H:%M:%S', this.x) + '<br/>' +
                    Highcharts.numberFormat(this.y, 2)+'ms';
            }
        },
        legend: {
            enabled: false
        },
        credits: {
            enabled: false
        },
        series: [{
            name: '实时延时',
            marker: {
                //小圆点
                enabled: false
            },
            data: (function () {
                // 生成随机值
                var data = [],
                    time = (new Date()).getTime(),
                    i;
                for (i = -19; i <= 0; i += 1) {
                    data.push({
                        x: time + i * 1000,
                        y: Math.floor(Math.random()*1000),
                    });
                }
                return data;
            }())
        }]
    });
</script>
</body>
</html>